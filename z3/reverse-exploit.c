/* gcc -o reverse-exploit reverse-exploit.c */


#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char login[36];
char passwd[36];

int login_check(char *);
int password(char *);
int vuln(char *);
int f(int);
char ff(int,int);
void win() ;

void win(){ printf("You Win!!!!!\n") ; }

int main(int argc, char **argv)
{
  int ret = 0;
  int i;

  if(argc != 4)
  {
    while(1) {
      printf("Error: please input username and password and command.");
      return 1;
    }
  }

  ret = login_check(argv[1]);
  if (ret)
    ret = password(argv[2]);
  if(ret)
    vuln(argv[3]);
}

int vuln(char *buf)
{
  char info[36];

  strcpy(info, buf) ; 
  printf("%s\n", info) ;

  return 0 ;

}

int login_check(char *loginput)
{
  int expr = 4 + (10*0) - (-3); 

  if(
    strlen(loginput) == expr && 
    loginput[2] == 'c' &&
    loginput[3] == 2 &&
    loginput[5] == 0xd &&
    loginput[4] == ff(161,3) &&
    loginput[6] == 'a' &&
    loginput[1] == ff(15,75) &&
    loginput[0] == 'b'
  )
  {
    login[0] = loginput[3];
    login[1] = loginput[4];
    login[2] = loginput[6];
    login[3] = loginput[5];
    login[4] = loginput[3];
    login[5] = loginput[1];
    login[6] = 'a';
    login[7] = 'b';
    login[8] = 'c';
    login[9] = 'a';
    login[10] = 'p';
    login[11] = 'q';
    login[12] = 'r';
    login[13] = 's';
    login[14] = 't';
    login[15] = 'c';
    login[16] = '1';
    login[17] = '2';
    login[18] = '4';
    login[19] = '3';
    login[20] = 'e';
    login[21] = 'o';
    login[22] = 'a';
    login[23] = 'a';
    login[24] = 'b';
    login[25] = 'J';
    login[26] = 'E';
    login[27] = 'D';
    login[28] = 'I';
    login[29] = 'd';
    login[30] = '2';
    login[31] = 'd';
    login[32] = 'a';
    login[33] = 'a';
    login[34] = 'b';
    login[35] = 'y';

    return 1;
  }
  else return 0;
}

int password(char *passinput) 
{

  if(
    (passinput[0] == login[0] + 0x2A) &&
    (passinput[3] == login[1] - 3) &&
    (passinput[2] == (f(7) - 380)) &&
    (passinput[1] == ff(f(2),1))
  )
  {
    passwd[0] = passinput[0];
    passwd[1] = passinput[2];
    passwd[2] = passinput[1];
    passwd[3] = passinput[3];
    passwd[4] = 'a';
    passwd[5] = 'b';
    passwd[6] = 'c';
    passwd[7] = 'd';
    passwd[8] = 'r';
    passwd[9] = 's';
    passwd[10] = 'd';
    passwd[11] = 'd';
    passwd[12] = 'd';
    passwd[13] = 'd';
    passwd[14] = 'e';
    passwd[15] = 'e';
    passwd[16] = 'e';
    passwd[17] = 'f';
    passwd[18] = 'g';
    passwd[19] = 'h';
    passwd[20] = 'j';
    passwd[21] = '1';
    passwd[22] = '0';
    passwd[23] = '1';
    passwd[24] = '1';
    passwd[25] = '0';
    passwd[26] = '1';
    passwd[27] = 's';
    passwd[28] = 'P';
    passwd[29] = 'd';
    passwd[30] = 'd';
    passwd[31] = 'F';
    passwd[32] = 'O';
    passwd[33] = '-';
    passwd[34] = 'e';
    passwd[35] = 'f';
    return 1;
  }
  else return 0;
}

char ff(int i, int j) {
  if(i > 50) return i/j;
  else return i ^ j;
}

int f(int i)
{
  if (i == 0) return 0;
  else if (i == 1) return 1;
  else if (i == 2) return 54;
  else return f(i-1) + f(i-2);
}
